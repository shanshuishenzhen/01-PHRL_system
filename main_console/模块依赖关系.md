# PH&RL 在线考试系统 - 主控台模块依赖关系

## 概述

本文档描述了主控台模块与系统其他组件之间的依赖关系，帮助开发者理解系统架构和模块交互方式。

## 依赖关系图

```
+-------------------+
|    start_system   |
+-------------------+
          |
          v
+-------------------+
|    main_console   |<--------------+
+-------------------+               |
    |        |                      |
    v        v                      |
+-------+ +----------------+        |
| common| | 功能模块(由主控台启动) |        |
+-------+ +----------------+        |
    |              |                |
    v              v                |
+-------+    +-----------+    +----------+
| 工具类 |    | 题库管理   |----| 数据文件  |
+-------+    +-----------+    +----------+
                  |                ^
                  v                |
            +-----------+          |
            | 考试管理   |---------+
            +-----------+          |
                  |                |
                  v                |
            +-----------+          |
            | 评分中心   |---------+
            +-----------+          |
                  |                |
                  v                |
            +-----------+          |
            | 客户端    |---------+
            +-----------+
```

## 模块依赖说明

### 主控台模块依赖

主控台模块（main_console）依赖于以下组件：

1. **common 公共模块**
   - **config_manager.py**：配置管理，用于加载和保存系统配置
   - **logger.py**：日志记录，提供统一的日志功能
   - **process_manager.py**：进程管理，用于启动、停止和监控模块进程
   - **system_checker.py**：系统检查，用于检查系统环境和资源
   - **ui_components.py**：UI组件，提供统一的界面元素和主题

2. **系统启动器**
   - **start_system.py**：系统启动脚本，可以启动主控台

### 功能模块依赖

主控台模块负责启动和管理以下功能模块：

1. **题库管理模块**（question_bank_web）
   - 依赖于数据文件进行题库的存储和管理
   - 提供题库的增删改查功能

2. **考试管理模块**（exam_management）
   - 依赖于题库管理模块获取题目信息
   - 依赖于数据文件存储考试配置和状态
   - 提供考试的创建、配置和管理功能

3. **评分中心模块**（grading_center）
   - 依赖于考试管理模块获取考试信息
   - 依赖于数据文件存储评分结果
   - 提供自动评分和手动评分功能

4. **客户端模块**（client）
   - 依赖于考试管理模块获取考试信息
   - 依赖于数据文件存储答题记录
   - 提供考生登录和答题功能

## 数据流向

### 配置数据流

1. 主控台加载系统配置（config.json）
2. 用户通过主控台修改配置
3. 主控台保存配置到配置文件
4. 功能模块在启动时读取配置文件

### 模块状态流

1. 主控台启动功能模块
2. 主控台定期检查模块进程状态
3. 主控台更新模块状态表格
4. 用户通过主控台控制模块（启动/停止/重启）

### 日志数据流

1. 各模块记录日志到各自的日志文件
2. 主控台读取日志文件并显示
3. 用户通过主控台查看和筛选日志

## 接口说明

### 主控台与功能模块的接口

主控台与功能模块之间主要通过以下方式进行交互：

1. **进程管理**
   - 主控台通过subprocess启动模块进程
   - 主控台通过psutil监控模块进程状态
   - 主控台通过进程ID终止模块进程

2. **配置共享**
   - 主控台和功能模块共享同一个配置文件（config.json）
   - 配置更改需要重启模块才能生效

3. **日志共享**
   - 主控台和功能模块使用共同的日志目录（logs/）
   - 每个模块有自己的日志文件

### 功能模块之间的接口

功能模块之间主要通过以下方式进行交互：

1. **数据文件**
   - 模块通过共享数据文件交换信息
   - 数据文件包括题库、考试配置、答题记录和评分结果等

2. **HTTP API**
   - 模块之间通过HTTP API进行实时数据交换
   - 例如，客户端通过API获取考试信息和提交答案

## 启动顺序

系统模块的推荐启动顺序如下：

1. 主控台模块（main_console）
2. 题库管理模块（question_bank_web）
3. 考试管理模块（exam_management）
4. 评分中心模块（grading_center）
5. 客户端模块（client）

主控台的"启动所有模块"功能会按照此顺序启动模块。

## 端口使用

各模块使用的默认端口如下：

1. 题库管理模块：5000
2. 考试管理模块：5001
3. 评分中心模块：5173
4. 客户端模块：8080

这些端口可以在系统配置中修改。

## 文件路径

### 主要文件路径

```
01-PHRL_system/
├── config.json                # 系统配置文件
├── start_system.py            # 系统启动脚本
├── main_console/
│   └── main_console.py        # 主控台模块主文件
├── common/
│   ├── config_manager.py      # 配置管理
│   ├── logger.py              # 日志记录
│   ├── process_manager.py     # 进程管理
│   ├── system_checker.py      # 系统检查
│   └── ui_components.py       # UI组件
├── question_bank_web/         # 题库管理模块
├── exam_management/           # 考试管理模块
├── grading_center/            # 评分中心模块
├── client/                    # 客户端模块
└── logs/                      # 日志目录
```

### 数据文件路径

```
01-PHRL_system/
├── data/
│   ├── questions/             # 题库数据
│   ├── exams/                 # 考试配置
│   ├── answers/               # 答题记录
│   └── results/               # 评分结果
```

## 扩展指南

### 添加新模块

要将新模块集成到系统中，需要：

1. 在配置文件中添加新模块的端口配置
   ```json
   "module_ports": {
     "existing_module": 5000,
     "new_module": 5002
   }
   ```

2. 在主控台的模块列表中添加新模块
   ```python
   modules = [
       # 现有模块
       {"name": "新模块", "key": "new_module", "port": self.config["module_ports"]["new_module"]},
   ]
   ```

3. 创建新模块的目录和主文件
   ```
   01-PHRL_system/
   └── new_module/
       └── new_module.py
   ```

4. 实现新模块的功能，确保它能够：
   - 读取系统配置
   - 使用指定的端口
   - 记录日志到logs目录

### 修改依赖关系

如果需要修改模块之间的依赖关系，应考虑：

1. 更新配置文件结构
2. 修改数据文件格式和路径
3. 更新模块之间的API接口
4. 调整模块启动顺序

## 故障排除

### 依赖问题

1. **模块无法启动**
   - 检查依赖模块是否已启动
   - 检查端口是否被占用
   - 检查配置文件是否正确

2. **模块之间无法通信**
   - 检查网络连接
   - 检查端口配置
   - 检查API路径和参数

3. **数据不同步**
   - 检查数据文件权限
   - 检查文件锁定机制
   - 检查数据更新逻辑

## 版本兼容性

在更新系统组件时，应注意版本兼容性：

1. 主控台与功能模块的版本应匹配
2. 配置文件格式应向后兼容
3. 数据文件格式应向后兼容
4. API接口应向后兼容

## 总结

主控台模块是PH&RL在线考试系统的核心控制中心，它与系统其他组件有着复杂的依赖关系。理解这些依赖关系对于系统的开发、维护和扩展至关重要。本文档提供了主控台模块与其他组件之间依赖关系的详细说明，帮助开发者更好地理解系统架构和模块交互方式。