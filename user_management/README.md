# 用户管理模块 (User Management)

## 👥 模块概述

用户管理模块是 PH&RL 在线考试系统的重要组成部分，负责系统用户的统一管理和权限控制。该模块基于 Python Tkinter 开发，提供完整的用户生命周期管理功能，支持用户的增删改查、角色权限管理、批量操作等功能，为系统提供安全可靠的用户认证和授权服务。

## 🎯 主要功能

### 用户管理
- **新增用户**：创建新用户账户，设置基本信息
- **编辑用户**：修改用户信息和权限设置
- **删除用户**：安全删除用户账户
- **用户搜索**：根据条件快速查找用户
- **用户详情**：查看用户完整信息和操作历史
- **状态管理**：激活、禁用、锁定用户账户

### 角色权限
- **角色管理**：超级用户、管理员、考评员、考生
- **权限分配**：为不同角色分配相应权限
- **权限验证**：实时验证用户操作权限
- **权限继承**：支持权限的继承和覆盖
- **自定义角色**：支持创建自定义角色和权限

### 批量操作
- **批量导入**：支持Excel/CSV文件批量导入用户
- **批量导出**：导出用户信息为多种格式
- **批量修改**：批量修改用户属性和权限
- **批量删除**：安全批量删除用户账户
- **数据校验**：导入前自动校验数据有效性

### 审批管理
- **用户审批**：新用户注册审批流程
- **权限审批**：权限变更审批流程
- **操作日志**：记录所有用户操作历史
- **审计追踪**：完整的操作审计功能
- **异常警报**：异常操作自动警报

## 🏗️ 技术架构

### 开发技术
- **编程语言**：Python 3.x
- **GUI框架**：Tkinter (Python标准库)
- **数据处理**：JSON文件存储
- **界面设计**：原生Tkinter组件
- **数据验证**：Python内置验证
- **加密算法**：密码安全哈希存储

### 文件结构
```
user_management/
├── simple_user_manager.py       # 主程序文件
├── users.json                   # 用户数据文件
├── roles.json                   # 角色权限配置
├── logs/                        # 操作日志目录
│   ├── operation.log            # 操作日志
│   └── error.log                # 错误日志
├── backup/                      # 数据备份目录
│   └── users_backup_20240115.json  # 备份文件示例
├── user_import_template.csv     # 批量导入模板
└── README.md                    # 模块说明文档
```

### 数据格式

#### 用户数据 (users.json)
```json
{
  "users": [
    {
      "id": "u001",
      "username": "admin",
      "password": "123456",
      "real_name": "系统管理员",
      "role": "super_admin",
      "email": "admin@phrl-exam.com",
      "phone": "13800138000",
      "department": "系统管理部",
      "status": "active",
      "created_time": "2024-01-15 10:30:00",
      "last_login": "2024-01-15 15:30:00",
      "permissions": ["all"]
    },
    {
      "id": "u002",
      "username": "teacher001",
      "password": "123456",
      "real_name": "张老师",
      "role": "evaluator",
      "email": "teacher001@phrl-exam.com",
      "phone": "13900139000",
      "department": "教务处",
      "status": "active",
      "created_time": "2024-01-15 11:30:00",
      "last_login": "2024-01-15 14:30:00",
      "permissions": ["grade_manage", "score_view"]
    }
  ]
}
```

#### 角色权限 (roles.json)
```json
{
  "roles": {
    "super_admin": {
      "name": "超级用户",
      "permissions": ["all"],
      "description": "系统最高权限"
    },
    "admin": {
      "name": "管理员",
      "permissions": ["user_manage", "exam_manage", "question_manage"],
      "description": "系统管理权限"
    },
    "evaluator": {
      "name": "考评员",
      "permissions": ["grade_manage", "score_view"],
      "description": "阅卷和评分权限"
    },
    "student": {
      "name": "考生",
      "permissions": ["exam_take", "score_view"],
      "description": "考试和查看成绩权限"
    }
  }
}
```

## 🚀 快速开始

### 环境要求
- **Python**：3.6+
- **依赖库**：Tkinter (标准库), pandas, openpyxl (用于批量导入)
- **操作系统**：Windows, Linux, macOS

### 安装依赖
```bash
# 安装批量导入所需依赖
pip install pandas openpyxl
```

### 启动方式
```bash
# 方式1：通过主控台启动（推荐）
python main_console.py
# 然后点击"用户管理"按钮

# 方式2：通过启动器启动
python launcher.py
# 然后选择"用户管理"模块

# 方式3：直接启动
python user_management/simple_user_manager.py
```

## 📋 使用指南

### 基本操作

#### 1. 新增用户
1. 点击"➕ 新增用户"按钮
2. 填写用户基本信息（用户名、姓名、邮箱等）
3. 选择用户角色（超级用户、管理员、考评员、考生）
4. 设置初始密码
5. 点击"保存"完成添加

#### 2. 编辑用户
1. 在用户列表中选择要编辑的用户
2. 点击"✏️ 编辑用户"按钮
3. 修改用户信息或权限设置
4. 点击"保存"完成修改

#### 3. 删除用户
1. 在用户列表中选择要删除的用户
2. 点击"🗑️ 删除用户"按钮
3. 确认删除操作
4. 用户将从系统中永久删除

#### 4. 搜索用户
1. 在搜索框中输入关键词
2. 选择搜索条件（用户名、姓名、角色等）
3. 点击"🔍 搜索"按钮
4. 查看搜索结果

#### 5. 批量导入
1. 点击"📥 批量导入"按钮
2. 选择要导入的Excel/CSV文件
3. 在预览窗口中检查数据是否正确
4. 点击"✅ 确认导入"按钮完成导入

#### 6. 批量导出
1. 点击"📤 批量导出"按钮
2. 选择导出格式和保存位置
3. 确认导出操作
4. 用户信息将导出为文件

## 📥 批量导入功能

### 模板格式 (user_import_template.csv)

批量导入功能支持CSV和Excel文件，推荐使用CSV格式，模板文件为 `user_import_template.csv`。

| 列名 | 必填 | 说明 | 示例 |
|------------|:----:|--------------------------|---------------------------|
| username | ✅ | 用户名（唯一，建议用英文） | student001 |
| real_name | ✅ | 真实姓名 | 张三 |
| ID | ✅ | 身份证号码 | 123456789012345678 |
| role | ✅ | 用户角色 | student |
| email | ✅ | 邮箱地址 | zhangsan@example.com |
| password | ❌ | 密码（默认为 '123456'） | 123456 |
| phone | ❌ | 手机号码 | 13800138000 |
| department | ❌ | 所属部门/班级 | 计算机系 |
| status | ❌ | 用户状态（默认为 'active'）| active |

### 角色说明 (`role`)
- `student`: 考生
- `examiner`: 考评员
- `admin`: 管理员
- `super_admin`: 超级用户

### 状态说明 (`status`)
- `active`: 正常
- `inactive`: 禁用
- `pending`: 待审批

### 使用步骤
1. **下载/准备模板**：使用 `user_management/user_import_template.csv` 作为模板，在Excel或文本编辑器中填写用户信息。
2. **启动用户管理**：打开用户管理模块界面。
3. **点击导入**：点击 "📥 批量导入" 按钮。
4. **选择文件**：在弹出的窗口中选择您编辑好的 `csv` 或 `xlsx` 文件。
5. **预览确认**：在预览窗口中检查数据是否正确。
6. **开始导入**：点击 "✅ 确认导入" 按钮完成导入。

## 🗑️ 批量删除功能

### 使用步骤
1. 在用户列表中按住 `Ctrl` 或 `Shift` 键，用鼠标点击选中多个用户。
2. 点击 "🗑️ 批量删除" 按钮。
3. 在弹出的确认框中确认删除。
4. 系统会自动过滤掉超级用户，只删除普通用户。

## 📊 功能特性

### 用户界面
- **直观布局**：清晰的界面布局，操作简单
- **响应式设计**：支持不同屏幕分辨率
- **主题支持**：支持浅色/深色主题切换
- **快捷键**：支持常用操作的键盘快捷键
- **状态指示**：用户状态直观显示

### 数据处理
- **实时保存**：操作后自动保存数据
- **数据验证**：输入数据格式验证
- **错误处理**：完善的异常处理机制
- **备份恢复**：自动备份和手动恢复功能
- **数据导出**：多种格式导出支持

### 安全特性
- **密码加密**：用户密码安全存储
- **权限控制**：严格的权限验证机制
- **操作日志**：完整的操作记录
- **审计追踪**：用户行为审计功能
- **会话管理**：安全的会话控制

### 性能优化
- **分页显示**：大量用户时分页显示
- **搜索优化**：快速搜索算法
- **内存管理**：优化的内存使用
- **启动速度**：快速启动和加载
- **异步处理**：耗时操作异步执行

## 🔧 配置说明

### 系统配置
```python
# 用户数据文件路径
USERS_FILE = "users.json"

# 角色配置文件路径
ROLES_FILE = "roles.json"

# 每页显示用户数量
PAGE_SIZE = 20

# 密码最小长度
MIN_PASSWORD_LENGTH = 6

# 自动备份间隔（分钟）
AUTO_BACKUP_INTERVAL = 30
```

### 界面配置
```python
# 窗口大小
WINDOW_WIDTH = 1200
WINDOW_HEIGHT = 800

# 字体设置
FONT_FAMILY = "Microsoft YaHei"
FONT_SIZE = 10

# 颜色主题
THEME_COLORS = {
    "primary": "#007bff",
    "secondary": "#6c757d",
    "success": "#28a745",
    "danger": "#dc3545"
}
```

## 🔄 与其他模块的集成

### 数据交互
- **考试管理模块**：提供用户信息，接收考试权限设置
- **题库管理模块**：提供用户权限验证
- **阅卷中心**：提供考评员信息和权限
- **成绩统计**：提供用户分组和权限信息

### API接口
- **用户验证**：`/api/users/authenticate`
- **用户信息**：`/api/users/{id}`
- **权限验证**：`/api/users/{id}/permissions`
- **用户列表**：`/api/users?role={role}`

## 🚨 故障排除

### 常见问题

#### 1. 程序启动失败
```bash
# 检查Python环境
python --version

# 检查tkinter
python -c "import tkinter; print('tkinter可用')"

# 检查文件权限
ls -la simple_user_manager.py
```

#### 2. 用户数据文件损坏
```bash
# 检查用户数据文件
cat users.json

# 恢复备份文件
cp backup/users_backup.json users.json
```

#### 3. 权限验证失败
- 检查用户角色配置是否正确
- 确认权限文件格式是否有效
- 验证用户状态是否为激活状态

#### 4. 批量导入失败
- 检查导入文件格式是否正确
- 确认文件编码为UTF-8
- 验证必填字段是否完整

### 错误代码说明
- **E001**：用户数据文件不存在
- **E002**：用户数据文件格式错误
- **E003**：用户数据验证失败
- **E004**：权限配置错误
- **E005**：导入文件格式错误

## 📈 性能指标

### 系统性能
- **启动时间**：< 3秒
- **搜索响应**：< 1秒
- **数据保存**：< 500ms
- **内存占用**：< 100MB

### 数据容量
- **单文件用户数**：支持10,000+用户
- **文件大小**：< 50MB
- **备份文件**：自动保留最近10个备份

## 🔄 版本历史

### v1.0.0 (2024-01-15)
- ✅ 完成基础用户管理功能
- ✅ 实现角色权限管理
- ✅ 添加批量操作功能
- ✅ 实现操作日志记录
- ✅ 优化用户界面设计

### v1.1.0 (计划中)
- 🔄 添加用户组管理功能
- 🔄 实现单点登录(SSO)
- 🔄 添加用户行为分析
- 🔄 支持更多认证方式
- 🔄 实现用户自助服务

## 📞 技术支持

### 联系方式
- **模块负责人**：用户管理开发组
- **技术支持**：support@phrl-exam.com
- **问题反馈**：issues@phrl-exam.com

### 支持时间
- **工作日**：9:00-18:00
- **紧急支持**：7×24小时

---

**用户管理模块** - 让用户管理更安全、更高效！
