# 客户机端模块

## 💻 模块概述

客户机端模块是 PH&RL 在线考试系统的考生答题界面，为考生提供专业的在线考试体验。该模块基于 Tkinter 开发，提供完整的考试流程管理，包括登录认证、考试列表、答题界面、自动交卷等功能，确保考试过程的公平性和安全性。

## 🎯 主要功能

### 用户认证
- **考生登录**：使用考生账户登录系统
- **身份验证**：验证考生身份和考试权限
- **会话管理**：安全的会话管理和超时处理
- **权限控制**：基于角色的功能访问控制

### 考试管理
- **考试列表**：查看可参加的考试列表
- **考试详情**：查看考试信息和要求，包括试卷总分和及格分
- **考试状态**：实时显示考试状态和进度
- **考试历史**：查看历史考试记录
- **成绩展示**：考试完成后，立即显示得分、总分、及格分和是否及格等信息

### 答题功能
- **多题型支持**：支持选择题、填空题、简答题等
- **实时保存**：答题过程中自动保存答案
- **答案预览**：查看已答题目和未答题目
- **题目导航**：快速跳转到指定题目

### 安全特性
- **防作弊机制**：全屏置顶、禁用快捷键
- **断线重连**：网络中断时自动重连
- **时间控制**：严格的考试时间控制
- **数据加密**：答题数据传输加密

## 🏗️ 技术架构

### 开发技术
- **GUI框架**：Tkinter (Python标准库)
- **网络通信**：HTTP/HTTPS协议
- **数据存储**：本地缓存 + 服务器同步
- **安全机制**：加密传输、会话管理
- **打包工具**：PyInstaller (v1.1.0新增)

### 文件路径处理 (v1.1.0新增)
- **绝对路径转换**：自动识别运行环境，转换相对路径为绝对路径
- **应用根目录检测**：智能检测应用程序根目录，适应不同运行环境
- **兼容性处理**：同时支持开发环境和打包后环境的文件访问

### 文件结构
```
client/
├── client_app.py               # 主程序文件
├── login_window.py             # 登录窗口
├── exam_list_window.py         # 考试列表窗口
├── exam_window.py              # 考试答题窗口
├── utils/                      # 工具函数
│   ├── network.py              # 网络通信
│   ├── security.py             # 安全机制
│   └── data_manager.py         # 数据管理
├── config/                     # 配置文件
│   ├── settings.json           # 系统配置
│   └── exam_config.json        # 考试配置
├── data/                       # 本地数据
│   ├── cache/                  # 缓存文件
│   └── temp/                   # 临时文件
└── README.md                   # 模块说明文档
```

### 数据格式
```json
{
  "exam_info": {
    "id": "exam001",
    "name": "数学期中考试",
    "description": "考试说明",
    "duration": 120,
    "total_score": 100,
    "start_time": "2024-01-15 09:00:00",
    "end_time": "2024-01-15 11:00:00",
    "status": "active"
  },
  "questions": [
    {
      "id": "q001",
      "type": "choice",
      "content": "题目内容",
      "options": ["A", "B", "C", "D"],
      "score": 5,
      "required": true
    }
  ],
  "answers": {
    "q001": "A",
    "q002": "答案内容"
  }
}
```

## 🚀 使用指南

### 启动方式
```bash
# 方式1：通过主控台启动（推荐）
python main_console.py
# 然后点击"客户机端"按钮

# 方式2：直接启动
python client/client_app.py

# 方式3：使用打包后的可执行文件（v1.1.0新增）
# 双击运行 dist/client_app.exe
```

### 可执行文件使用说明（v1.1.0新增）

#### 运行环境要求
- Windows操作系统
- 无需安装Python环境
- 确保exam_management目录与可执行文件在同一目录下

#### 使用步骤
1. 双击运行`dist/client_app.exe`
2. 系统自动加载考试和试卷数据
3. 按照正常流程登录并参加考试

#### 注意事项
- 可执行文件需要与exam_management目录保持在同一相对位置
- 如遇到文件路径错误，请检查exam_management目录是否存在
- 答案文件将保存在exam_management/answers目录下

### 基本操作

#### 1. 考生登录
1. 启动客户机端程序
2. 输入考生用户名和密码
3. 点击"登录"按钮
4. 验证身份后进入考试列表

#### 2. 选择考试
1. 在考试列表中查看可参加的考试
2. 查看考试详细信息和要求，包括试卷总分和及格分
3. 确认考试时间和规则
4. 点击"进入考试"按钮

#### 3. 答题过程
1. 仔细阅读题目内容
2. 根据题目类型选择答案
3. 系统自动保存答案
4. 使用题目导航切换题目

#### 4. 交卷操作
1. 检查所有题目是否已答
2. 确认答案无误后点击"交卷"
3. 系统自动提交答案
4. 显示交卷成功信息

#### 5. 查看考试结果

1. 考试提交后，系统自动跳转到考试结果页面
2. 考试结果页面显示以下信息：
   - 考试名称
   - 得分（以大字体突出显示）
   - 试卷总分
   - 及格分数
   - 考试结果（及格/不及格，以不同颜色区分）
3. 点击"返回考试列表"按钮返回考试列表页面
4. 可在考试列表中查看历史考试记录

## 📊 功能特性

### 用户界面
- **简洁设计**：清晰的界面布局，减少干扰
- **响应式布局**：适配不同屏幕分辨率
- **主题支持**：支持考试主题切换
- **字体优化**：适合长时间阅读的字体设置

### 答题体验
- **流畅操作**：优化的答题流程和交互
- **实时反馈**：答题状态实时显示
- **智能提示**：未答题目和错误提示
- **快捷操作**：键盘快捷键支持

### 安全机制
- **全屏模式**：防止切换窗口作弊
- **快捷键禁用**：禁用可能作弊的快捷键
- **网络监控**：实时监控网络连接状态
- **数据保护**：答题数据加密传输

### 性能优化
- **快速启动**：优化的程序启动速度
- **内存管理**：高效的内存使用
- **网络优化**：智能的网络请求管理
- **缓存机制**：本地缓存减少网络请求

## 🔧 配置说明

### 系统配置
```json
{
  "server": {
    "host": "localhost",
    "port": 3000,
    "protocol": "http"
  },
  "security": {
    "encryption": true,
    "session_timeout": 3600,
    "auto_save_interval": 30
  },
  "ui": {
    "fullscreen": true,
    "disable_shortcuts": true,
    "font_size": 12,
    "theme": "light"
  },
  "network": {
    "retry_attempts": 3,
    "retry_interval": 5,
    "connection_timeout": 10
  }
}
```

### 考试配置
```json
{
  "exam_rules": {
    "allow_review": true,
    "allow_mark": true,
    "auto_submit": true,
    "warning_time": 300
  },
  "question_types": {
    "choice": {
      "single": true,
      "multiple": true
    },
    "fill_blank": {
      "case_sensitive": false,
      "partial_match": true
    },
    "essay": {
      "word_limit": 1000,
      "auto_save": true
    }
  }
}
```

### 界面配置
```python
# 窗口配置
WINDOW_WIDTH = 1200
WINDOW_HEIGHT = 800
FULLSCREEN = True

# 字体配置
FONT_FAMILY = "Microsoft YaHei"
FONT_SIZE = 12
FONT_WEIGHT = "normal"

# 颜色主题
THEME_COLORS = {
    "primary": "#007bff",
    "secondary": "#6c757d",
    "success": "#28a745",
    "danger": "#dc3545",
    "warning": "#ffc107",
    "info": "#17a2b8"
}
```

## 🚨 故障排除

### 常见问题

#### 1. 程序启动失败
```bash
# 检查Python环境（源码运行时）
python --version

# 检查tkinter（源码运行时）
python -c "import tkinter; print('tkinter可用')"

# 检查网络连接
ping localhost

# 检查可执行文件环境（v1.1.0新增）
# 确认exam_management目录存在于可执行文件同级目录
dir dist\exam_management
```

#### 1.1 可执行文件启动问题（v1.1.0新增）
- **文件路径错误**：确保exam_management目录与可执行文件在同一目录
- **缺少DLL文件**：检查是否有杀毒软件拦截或删除了必要的DLL文件
- **权限问题**：尝试以管理员身份运行可执行文件
- **数据文件缺失**：确认exam_management目录下的exams.json和papers.json文件存在

#### 2. 登录失败
- 检查用户名和密码是否正确
- 确认网络连接正常
- 验证服务器是否运行
- 检查账户状态是否正常

#### 3. 考试加载失败
- 检查网络连接状态
- 确认考试时间是否正确
- 验证考试权限是否有效
- 查看错误日志信息

#### 4. 答题保存失败
- 检查网络连接
- 确认服务器状态
- 验证数据格式是否正确
- 查看本地缓存状态

### 错误代码说明
- **E001**：网络连接失败
- **E002**：用户认证失败
- **E003**：考试权限不足
- **E004**：数据保存失败
- **E005**：系统配置错误

## 📈 性能指标

### 系统性能
- **启动时间**：< 3秒
- **登录响应**：< 2秒
- **答题保存**：< 1秒
- **内存占用**：< 150MB

### 网络性能
- **连接建立**：< 1秒
- **数据传输**：< 500ms
- **断线重连**：< 5秒
- **数据同步**：< 2秒

## 🔄 版本历史

### v1.1.0 (2024-06-30)
- ✅ 优化文件路径处理逻辑，解决PyInstaller打包后路径问题
- ✅ 添加试卷数据支持，完善考试引用试卷机制
- ✅ 修复加载papers.json时的变量名错误
- ✅ 改进可执行文件生成流程，提高稳定性

### v1.0.0 (2024-01-15)
- ✅ 完成基础答题功能
- ✅ 实现防作弊机制
- ✅ 添加断线重连功能
- ✅ 实现自动交卷功能
- ✅ 优化用户界面设计

### 下一步计划
- 🔄 添加语音播报功能
- 🔄 实现离线答题模式
- 🔄 添加答题辅助工具
- 🔄 支持更多题型
- 🔄 实现移动端适配

## 🔨 打包与部署（v1.1.0新增）

### PyInstaller打包
```bash
# 在项目根目录执行
pyinstaller d:\01-PHRL_system\client\client_app.py --onefile

# 复制必要的数据文件
xcopy d:\01-PHRL_system\exam_management d:\01-PHRL_system\dist\exam_management /E /I /H
```

### 部署步骤
1. 确保dist目录下有client_app.exe文件
2. 确保dist目录下有exam_management目录及其所有子文件
3. 将整个dist目录复制到目标机器上
4. 双击client_app.exe运行程序

### 更新部署
- 替换client_app.exe文件
- 更新exam_management目录下的数据文件
- 保留exam_management/answers目录中的答案文件

## 📞 技术支持

### 联系方式
- **模块负责人**：客户机端开发组
- **技术支持**：support@phrl-exam.com
- **问题反馈**：issues@phrl-exam.com

### 支持时间
- **工作日**：9:00-18:00
- **紧急支持**：7×24小时

---

**客户机端模块** - 让考试更便捷、更安全！