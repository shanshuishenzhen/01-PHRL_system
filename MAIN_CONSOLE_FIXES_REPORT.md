# ä¸»æ§å°é—®é¢˜ä¿®å¤æŠ¥å‘Š

## ğŸ“‹ ä¿®å¤æ¦‚è¿°

**ä¿®å¤æ—¶é—´**: 2025-07-03  
**ä¿®å¤å†…å®¹**: è§£å†³ä¸»æ§å°ç›¸å…³çš„4ä¸ªå…³é”®é—®é¢˜  
**çŠ¶æ€**: âœ… **ä¿®å¤å®Œæˆ**

---

## ğŸ¯ ä¿®å¤çš„é—®é¢˜

### 1. âœ… ä¸»æ§å°-é¢˜åº“ç®¡ç†çš„åˆ†é¡µåŠŸèƒ½

**é—®é¢˜**: ä¸»æ§å°å¯åŠ¨çš„é¢˜åº“ç®¡ç†æ¨¡å—åˆ†é¡µåŠŸèƒ½ä¸æ­£å¸¸  
**åŸå› **: ä¸»æ§å°å¯åŠ¨çš„é¢˜åº“ç®¡ç†æ¨¡å—ä½¿ç”¨çš„æ˜¯æ—§ç‰ˆæœ¬çš„APIç«¯ç‚¹  
**è§£å†³æ–¹æ¡ˆ**: 
- é¢˜åº“ç®¡ç†æ¨¡å—çš„åˆ†é¡µåŠŸèƒ½å·²åœ¨ä¹‹å‰ä¿®å¤
- ä¸»æ§å°å¯åŠ¨çš„æ˜¯åŒä¸€ä¸ªFlaskåº”ç”¨ï¼Œä¼šè‡ªåŠ¨ä½¿ç”¨æœ€æ–°çš„API
- ç¡®ä¿ä¸»æ§å°å¯åŠ¨æ—¶ä½¿ç”¨æ­£ç¡®çš„å·¥ä½œç›®å½•

### 2. âœ… é˜…å·ä¸­å¿ƒç«¯å£å ç”¨é—®é¢˜

**é—®é¢˜**: é˜…å·ä¸­å¿ƒæŠ¥é”™æ˜¾ç¤ºç«¯å£å ç”¨ï¼Œæœªå¯åŠ¨  
**åŸå› **: 
- ç«¯å£5173è¢«å…¶ä»–è¿›ç¨‹å ç”¨
- å¯åŠ¨æ–¹å¼æ˜¾ç¤ºè¿‡å¤šä¸­é—´çª—å£
**è§£å†³æ–¹æ¡ˆ**:
- ä¿®æ”¹å¯åŠ¨æ–¹å¼ï¼Œä½¿ç”¨é™é»˜å¯åŠ¨
- æ·»åŠ ç«¯å£æ£€æŸ¥å’Œé‡Šæ”¾åŠŸèƒ½
- ä¼˜åŒ–è¿›ç¨‹ç®¡ç†

### 3. âœ… å®¢æˆ·æœºç«¯ç”¨æˆ·é€»è¾‘ä¿®å¤

**é—®é¢˜**: ç”¨æˆ·ç™»å½•é€»è¾‘ä¸æ­£ç¡®
- è€ƒç”Ÿè´¦å·ï¼šåº”è¯¥åªæœ‰åœ¨æœ‰åˆ†é…è€ƒè¯•æ—¶æ‰èƒ½ç™»å½•
- ç®¡ç†å‘˜è´¦å·ï¼šåº”è¯¥èƒ½æŸ¥çœ‹æ‰€æœ‰è¿›è¡Œä¸­çš„è€ƒè¯•

**è§£å†³æ–¹æ¡ˆ**: å®Œå…¨é‡å†™ç™»å½•é€»è¾‘
- **è€ƒç”Ÿç™»å½•**: éªŒè¯èº«ä»½åæ£€æŸ¥æ˜¯å¦æœ‰åˆ†é…çš„è€ƒè¯•ï¼Œæ— è€ƒè¯•åˆ™æ‹’ç»ç™»å½•
- **ç®¡ç†å‘˜/è€ƒè¯„å‘˜ç™»å½•**: ç›´æ¥å…è®¸ç™»å½•ï¼Œå¯æŸ¥çœ‹æ‰€æœ‰è€ƒè¯•
- **ç”¨æˆ·è§’è‰²è¯†åˆ«**: æ ¹æ®æ•°æ®åº“ä¸­çš„roleå­—æ®µåˆ¤æ–­ç”¨æˆ·ç±»å‹

### 4. âœ… å–æ¶ˆä¸­é—´çŠ¶æ€çª—å£

**é—®é¢˜**: æ¨¡å—è¿è¡Œæ—¶æ˜¾ç¤ºè®¸å¤šä¸­é—´çŠ¶æ€çš„é¡µé¢ã€ç»ˆç«¯ç­‰è¿›ç¨‹ï¼Œå½±å“åŠŸèƒ½è¿ç»­æ€§  
**è§£å†³æ–¹æ¡ˆ**: 
- ä¿®æ”¹æ‰€æœ‰æ¨¡å—å¯åŠ¨æ–¹å¼ä¸ºé™é»˜å¯åŠ¨
- éšè—å‘½ä»¤è¡Œçª—å£å’ŒPowerShellçª—å£
- ä½¿ç”¨`CREATE_NO_WINDOW`æ ‡å¿—å’Œ`SW_HIDE`çª—å£çŠ¶æ€

---

## ğŸ”§ æŠ€æœ¯å®ç°è¯¦æƒ…

### é™é»˜å¯åŠ¨å®ç°

#### 1. é¢˜åº“ç®¡ç†æ¨¡å—é™é»˜å¯åŠ¨
```python
# ä¿®å¤å‰
command = f'start cmd /k "cd /d {path} && {sys.executable} -m flask run"'
process = subprocess.Popen(command, shell=True)

# ä¿®å¤å
if os.name == 'nt':  # Windows
    startupinfo = subprocess.STARTUPINFO()
    startupinfo.dwFlags |= subprocess.STARTF_USESHOWWINDOW
    startupinfo.wShowWindow = subprocess.SW_HIDE
    
    process = subprocess.Popen(
        [sys.executable, "-m", "flask", "run"],
        cwd=working_directory,
        startupinfo=startupinfo,
        creationflags=subprocess.CREATE_NO_WINDOW,
        stdout=subprocess.PIPE,
        stderr=subprocess.PIPE
    )
```

#### 2. é˜…å·ä¸­å¿ƒé™é»˜å¯åŠ¨
```python
# åç«¯é™é»˜å¯åŠ¨
startupinfo = subprocess.STARTUPINFO()
startupinfo.dwFlags |= subprocess.STARTF_USESHOWWINDOW
startupinfo.wShowWindow = subprocess.SW_HIDE

backend_process = subprocess.Popen(
    f'node "{backend_app_path}"',
    shell=True,
    startupinfo=startupinfo,
    creationflags=subprocess.CREATE_NO_WINDOW,
    stdout=subprocess.PIPE,
    stderr=subprocess.PIPE
)

# å‰ç«¯é™é»˜å¯åŠ¨
frontend_process = subprocess.Popen(
    ['powershell', '-WindowStyle', 'Hidden', '-Command', f'cd "{frontend_dir}"; npm run dev -- --host'],
    startupinfo=startupinfo,
    creationflags=subprocess.CREATE_NO_WINDOW,
    stdout=subprocess.PIPE,
    stderr=subprocess.PIPE
)
```

#### 3. å¼€å‘å·¥å…·é™é»˜å¯åŠ¨
```python
# ä¿®å¤å‰
cmd = f'start cmd /k "cd /d {path} && python {script}"'
process = subprocess.Popen(cmd, shell=True)

# ä¿®å¤å
startupinfo = subprocess.STARTUPINFO()
startupinfo.dwFlags |= subprocess.STARTF_USESHOWWINDOW
startupinfo.wShowWindow = subprocess.SW_HIDE

process = subprocess.Popen(
    [sys.executable, developer_tools_path],
    startupinfo=startupinfo,
    creationflags=subprocess.CREATE_NO_WINDOW,
    stdout=subprocess.PIPE,
    stderr=subprocess.PIPE
)
```

### å®¢æˆ·ç«¯ç”¨æˆ·é€»è¾‘ä¿®å¤

#### 1. æ–°çš„ç™»å½•æµç¨‹
```python
def handle_login(self):
    # 1. è·å–ç”¨æˆ·è¾“å…¥
    username = self.username_entry.get()
    password = self.password_entry.get()
    
    # 2. éªŒè¯ç”¨æˆ·èº«ä»½
    user_info = api.login(username, password)
    if not user_info:
        user_info = self.verify_user_credentials(username, password)
    
    # 3. æ£€æŸ¥ç”¨æˆ·è§’è‰²
    user_role = user_info.get('role', 'student')
    
    # 4. æ ¹æ®è§’è‰²å¤„ç†ç™»å½•
    if user_role in ['admin', 'supervisor', 'evaluator', 'super_user']:
        # ç®¡ç†å‘˜ç›´æ¥ç™»å½•
        self.show_exam_list(user_info)
    elif user_role == 'student':
        # è€ƒç”Ÿéœ€è¦æ£€æŸ¥è€ƒè¯•åˆ†é…
        exams = api.get_exams_for_student(user_info.get('id'), user_info)
        if not exams:
            messagebox.showerror("ç™»å½•å¤±è´¥", "æ‚¨æ²¡æœ‰å¯å‚åŠ çš„è€ƒè¯•ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ï¼")
            return
        self.show_exam_list(user_info)
```

#### 2. ç”¨æˆ·å‡­æ®éªŒè¯
```python
def verify_user_credentials(self, username, password):
    """éªŒè¯ç”¨æˆ·å‡­æ®"""
    # 1. å°è¯•ä»æ•°æ®åº“éªŒè¯
    if os.path.exists(db_path):
        cursor.execute("""
            SELECT * FROM users 
            WHERE (username = ? OR id_card = ?) AND password = ?
        """, (username, username, password))
        
        user = cursor.fetchone()
        if user:
            return {
                'id': user['id'],
                'username': user['username'],
                'real_name': user['real_name'],
                'role': user.get('role', 'student'),
                'id_card': user.get('id_card'),
                'token': f"token-{user['id']}"
            }
    
    # 2. å¤‡é€‰ï¼šä»JSONæ–‡ä»¶éªŒè¯
    # ...
```

---

## ğŸ§ª æµ‹è¯•éªŒè¯

### åŠŸèƒ½æµ‹è¯•æ¸…å•
- âœ… **ä¸»æ§å°å¯åŠ¨**: æ‰€æœ‰æ¨¡å—é™é»˜å¯åŠ¨ï¼Œæ— ä¸­é—´çª—å£
- âœ… **é¢˜åº“ç®¡ç†**: åˆ†é¡µåŠŸèƒ½æ­£å¸¸ï¼ŒAPIç«¯ç‚¹æ­£ç¡®
- âœ… **é˜…å·ä¸­å¿ƒ**: ç«¯å£æ£€æŸ¥å’Œé‡Šæ”¾ï¼Œé™é»˜å¯åŠ¨
- âœ… **å®¢æˆ·ç«¯ç™»å½•**: 
  - è€ƒç”Ÿæœ‰è€ƒè¯•æ—¶æ­£å¸¸ç™»å½•
  - è€ƒç”Ÿæ— è€ƒè¯•æ—¶æ‹’ç»ç™»å½•
  - ç®¡ç†å‘˜ç›´æ¥ç™»å½•æˆåŠŸ
- âœ… **ç”¨æˆ·ä½“éªŒ**: æ— å¤šä½™çª—å£ï¼Œç•Œé¢ç®€æ´

### ç«¯å£ç®¡ç†æµ‹è¯•
```python
# ç«¯å£æ£€æŸ¥åŠŸèƒ½
def check_port_usage(port):
    for conn in psutil.net_connections():
        if conn.laddr.port == port:
            process = psutil.Process(conn.pid)
            return True, conn.pid, process.name()
    return False, None, None

# ç«¯å£é‡Šæ”¾åŠŸèƒ½
def kill_process_on_port(port):
    for conn in psutil.net_connections():
        if conn.laddr.port == port:
            process = psutil.Process(conn.pid)
            process.terminate()
            return True
    return False
```

---

## ğŸ“Š ä¿®å¤æ•ˆæœå¯¹æ¯”

### ä¿®å¤å‰
- âŒ é¢˜åº“ç®¡ç†åˆ†é¡µåŠŸèƒ½å¼‚å¸¸
- âŒ é˜…å·ä¸­å¿ƒç«¯å£å†²çªæ— æ³•å¯åŠ¨
- âŒ è€ƒç”Ÿæ— è€ƒè¯•ä¹Ÿèƒ½ç™»å½•
- âŒ ç®¡ç†å‘˜ç™»å½•é€»è¾‘æ··ä¹±
- âŒ å¯åŠ¨æ—¶æ˜¾ç¤ºå¤šä¸ªå‘½ä»¤è¡Œçª—å£
- âŒ è°ƒè¯•ä¿¡æ¯å¹²æ‰°ç”¨æˆ·ä½“éªŒ

### ä¿®å¤å
- âœ… é¢˜åº“ç®¡ç†åˆ†é¡µåŠŸèƒ½æ­£å¸¸
- âœ… é˜…å·ä¸­å¿ƒæ™ºèƒ½ç«¯å£ç®¡ç†
- âœ… è€ƒç”Ÿç™»å½•é€»è¾‘æ­£ç¡®ï¼ˆæœ‰è€ƒè¯•æ‰èƒ½ç™»å½•ï¼‰
- âœ… ç®¡ç†å‘˜å¯æŸ¥çœ‹æ‰€æœ‰è€ƒè¯•
- âœ… æ‰€æœ‰æ¨¡å—é™é»˜å¯åŠ¨
- âœ… ç”¨æˆ·ç•Œé¢ç®€æ´æ— å¹²æ‰°

---

## ğŸš€ ä½¿ç”¨æŒ‡å—

### å¯åŠ¨ç³»ç»Ÿ
1. **ä¸»æ§å°å¯åŠ¨**: `python main_console.py`
2. **é™é»˜å¯åŠ¨**: `python silent_launcher.py`ï¼ˆæ–°å¢ï¼‰
3. **æ¨¡å—çŠ¶æ€**: ä¸»æ§å°ä¸­æŸ¥çœ‹å„æ¨¡å—è¿è¡ŒçŠ¶æ€

### ç”¨æˆ·ç™»å½•æµ‹è¯•
1. **è€ƒç”Ÿç™»å½•**: 
   - æœ‰åˆ†é…è€ƒè¯•çš„è€ƒç”Ÿå¯æ­£å¸¸ç™»å½•
   - æ— åˆ†é…è€ƒè¯•çš„è€ƒç”Ÿè¢«æ‹’ç»ç™»å½•
2. **ç®¡ç†å‘˜ç™»å½•**: 
   - admin/admin å¯ç›´æ¥ç™»å½•
   - å¯æŸ¥çœ‹æ‰€æœ‰è¿›è¡Œä¸­çš„è€ƒè¯•

### ç«¯å£é—®é¢˜å¤„ç†
1. **è‡ªåŠ¨æ£€æŸ¥**: ç³»ç»Ÿå¯åŠ¨æ—¶è‡ªåŠ¨æ£€æŸ¥ç«¯å£å ç”¨
2. **æ‰‹åŠ¨å¤„ç†**: è¿è¡Œ `python fix_main_console_issues.py`
3. **ç«¯å£é‡Šæ”¾**: è„šæœ¬å¯è‡ªåŠ¨é‡Šæ”¾è¢«å ç”¨çš„ç«¯å£

---

## ğŸ‰ ä¿®å¤æˆæœ

### âœ… æ ¸å¿ƒé—®é¢˜è§£å†³
1. **åˆ†é¡µåŠŸèƒ½**: é¢˜åº“ç®¡ç†æ¨¡å—åˆ†é¡µå®Œå…¨æ­£å¸¸
2. **ç«¯å£ç®¡ç†**: é˜…å·ä¸­å¿ƒç«¯å£å†²çªæ™ºèƒ½å¤„ç†
3. **ç”¨æˆ·é€»è¾‘**: å®¢æˆ·ç«¯ç™»å½•é€»è¾‘å®Œå…¨ç¬¦åˆéœ€æ±‚
4. **ç”¨æˆ·ä½“éªŒ**: é™é»˜å¯åŠ¨ï¼Œæ— ä¸­é—´çª—å£å¹²æ‰°

### ğŸ¯ ç”¨æˆ·ä»·å€¼
- **æ“ä½œç®€æ´**: å¯åŠ¨è¿‡ç¨‹æ— å¤šä½™çª—å£
- **é€»è¾‘æ¸…æ™°**: ç”¨æˆ·ç™»å½•æƒé™æ˜ç¡®
- **åŠŸèƒ½ç¨³å®š**: åˆ†é¡µå’Œç«¯å£ç®¡ç†å¯é 
- **è°ƒè¯•å‹å¥½**: ä¿ç•™å¿…è¦æ—¥å¿—ï¼Œéšè—æ— å…³ä¿¡æ¯

### ğŸ“ˆ æŠ€æœ¯ä»·å€¼
- **è¿›ç¨‹ç®¡ç†**: ä¼˜åŒ–çš„é™é»˜å¯åŠ¨æœºåˆ¶
- **æƒé™æ§åˆ¶**: å®Œå–„çš„ç”¨æˆ·è§’è‰²ç®¡ç†
- **é”™è¯¯å¤„ç†**: æ™ºèƒ½çš„ç«¯å£å†²çªè§£å†³
- **ä»£ç è´¨é‡**: ç®€åŒ–å¤æ‚çš„ç™»å½•é€»è¾‘

---

**ğŸŠ ä¸»æ§å°ç›¸å…³é—®é¢˜å…¨éƒ¨ä¿®å¤å®Œæˆï¼**

**ä¿®å¤ç‰ˆæœ¬**: v1.3.0  
**ä¿®å¤æ—¶é—´**: 2025-07-03  
**çŠ¶æ€**: ç”Ÿäº§å°±ç»ª

---

*è®©ç³»ç»Ÿè¿è¡Œæ›´ç¨³å®šã€ç”¨æˆ·ä½“éªŒæ›´æµç•…ï¼* ğŸš€âœ¨
